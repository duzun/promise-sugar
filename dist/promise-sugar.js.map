{"version":3,"file":"promise-sugar.js","sources":["../promise-sugar.js"],"sourcesContent":["/**\n *  Promise syntactic sugar - no need to write \".then\"\n *\n *  @license MIT\n *  @version 2.3.1\n *  @git https://github.com/duzun/promise-sugar\n *  @umd AMD, Browser, CommonJs\n *  @author Dumitru Uzun (DUzun.Me)\n */\n\n/*globals globalThis, window, global, self */\n\nconst VERSION = '2.3.1';\n\n// -------------------------------------------------------------\nlet nativePromise = typeof Promise != 'undefined' ? Promise : (typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {}).Promise;\n// -------------------------------------------------------------\nvar isArray = Array.isArray || function isArray(val) {\n    return val instanceof Array;\n};\n// -------------------------------------------------------------\n\nexport default function sweeten(p) {\n    // new Promise(p) - [[Construct]]\n    if ( this instanceof sweeten ) {\n        return sweeten(new nativePromise(p));\n    }\n\n    // Make sure p is a thenable\n    if ( !isThenable(p) ) {\n        p = nativePromise.resolve(p);\n    }\n\n    then.then = then;\n\n    let PromisePrototype = nativePromise.prototype;\n\n    // then.__proto__ = PromisePrototype; // not sure this is a good idea\n\n    // an alternative to setting then.__proto__:\n    then.constructor = nativePromise;\n\n    // Promise/A+\n    then.catch   = _catch  ;\n\n    // Q\n    then.finally = _finally;\n\n    // Goodies\n    then.timeout = _timeout;\n\n    if ( 'progress' in PromisePrototype ) {\n        then.progress = PromisePrototype.progress;\n    }\n\n    return then;\n\n    function then(onResolve, onReject, onNotify) {\n        if ( isThenable(onResolve) ) {\n            arguments[0] =\n            onResolve = _constant(onResolve);\n        }\n        if ( isThenable(onReject) ) {\n            arguments[1] =\n            onReject = _constant(onReject);\n        }\n        return sweeten(p.then.apply(p, arguments));\n    }\n}\n\n// -------------------------------------------------------------\nfunction _catch(onReject) {\n    return this.then(undefined, onReject);\n}\n\n// -------------------------------------------------------------\nfunction _finally(callback) {\n    return this.then(\n        (value) => resolver().then(() => value),\n        (reason) => resolver().then(() => { throw reason; })\n    );\n    function resolver() {\n        return sweeten.resolve(callback());\n    }\n}\n// -------------------------------------------------------------\n/**\n * Timeout a promise\n *\n * @param  int expires how long to wait for `promise` in ms\n * @param  bool throws If true, throw on timeout\n * @return Promise resolves before `expires` or rejects with timeout error\n */\nfunction _timeout(expires, throws=true) {\n    const promise = this;\n    let waiter = nWait(expires);\n    const { stop } = waiter;\n    if ( throws ) {\n        waiter = waiter.then(() => {\n            const error = new Error('Promise Timeout');\n            error.promise = promise;\n            throw error;\n        });\n    }\n    promise.then(() => stop().catch(_constant)); // no need to keep the waiter promise\n    return sweeten.race([promise, waiter]);\n}\n\n// -------------------------------------------------------------\nfunction _defer() {\n    var result = {};\n    result.promise = new nativePromise((resolve, reject, notify) => {\n        result.resolve = resolve;\n        result.reject  = reject;\n\n        // Q\n        if ( notify ) {\n            result.notify = notify;\n        }\n    });\n    return result;\n}\n// -------------------------------------------------------------\n// Some more sugar:\nsweeten.resolve = function resolve(val) { return sweeten(nativePromise.resolve(val)); };\nsweeten.reject  = function  reject(val) { return sweeten(nativePromise.reject(val)); };\nsweeten.race    = function    race(val) { return sweeten(nativePromise.race(val)); };\nsweeten.all     = function     all(val) { return sweeten(nativePromise.all(val)); };\n\nsweeten.any     = function     any(val) {\n    const prom = nativePromise.any ? nativePromise.any(val) : new nativePromise((resolve, reject) => {\n        let errors = [];\n        let count = 0;\n        function onReject(error) {\n            errors.push(error);\n            if(!--count) {\n                let error = new (typeof AggregateError == 'undefined' ? Error : AggregateError)('All promises rejected');\n                error.name = 'AggregateError';\n                error.errors = errors;\n                reject(error);\n            }\n        }\n        if(!isArray(val)) val = Array.from(val);\n        val.forEach((p) => {\n            ++count;\n            if(!isThenable(p)) p = nativePromise.resolve(p);\n            p.then(resolve, onReject);\n        });\n        // for(let p of val) {\n        //     ++count;\n        //     if(!isThenable(p)) p = nativePromise.resolve(p);\n        //     p.then(resolve, onReject);\n        // }\n    });\n    return sweeten(prom);\n};\n\nsweeten.allSettled = function allSettled(val) {\n    const prom = nativePromise.allSettled\n        ? nativePromise.allSettled(val)\n        : nativePromise.all(\n            val.map((value) => !isThenable(value)\n                ? { status: 'fulfilled', value }\n                : value.then(\n                    (value) => ({ status: 'fulfilled', value }),\n                    (reason) => ({ status: 'rejected', reason })\n                )\n            )\n        );\n    return sweeten(prom);\n};\n\n/**\n * Similar to Promise.all(list), but accepts an object with thenable values\n *\n * @param   {Object}  val  An object with promises as values\n *\n * @return  {Promise}       Resolves to an object with all values resolved.\n */\nsweeten.allValues = function allValues(val) {\n    if ( isArray(val) ) return sweeten.all(val);\n\n    const keys = Object.keys(val);\n    const len  = keys.length;\n    const values = new Array(len);\n    let isIndexed = val.length === len;\n    for ( var i=0, k; i<len; i++) {\n        k = keys[i];\n        if ( k != i ) isIndexed = false;\n        values[i] = val[k];\n    }\n    let prom = sweeten.all(values);\n    if ( !isIndexed ) {\n        prom = prom(function (values) {\n            let ret = {};\n            for ( var i=0; i<len; i++) {\n                ret[keys[i]] = values[i];\n            }\n            return ret;\n        });\n    }\n    return prom;\n};\n\nsweeten.when    = sweeten;\nsweeten.defer   = function defer() {\n    const defer = nativePromise.defer || _defer;\n    const deferred = defer.call(nativePromise);\n    deferred.promise = sweeten(deferred.promise);\n    return deferred;\n};\n\nsweeten.wait = wait;\nsweeten.isThenable = isThenable;\nsweeten.fn = fn;\n\n// -------------------------------------------------------------\n/// Use a custom Promise implementation\nfunction usePromise(PromiseConstructor) {\n    nativePromise = PromiseConstructor;\n}\n\n// -------------------------------------------------------------\nsweeten.usePromise = usePromise;\nsweeten.VERSION    = VERSION;\n\n// -------------------------------------------------------------\n// Helpers:\n// -------------------------------------------------------------\n\n/**\n * Make an ordinary function sweet for promises.\n *\n * @param  {Function} fn A function that returns any value or Promise\n * @param  {Any} ctx Context of fn (this)\n *\n * @return {Function} equivalent of fn that always returns a sweeten Promise\n */\nfunction fn(fn, ctx) {\n    return arguments.length > 1\n        ? function () {\n            return sweeten.all(arguments)((a) => fn.apply(ctx, a));\n        }\n        : function () {\n            var ctx = this;\n            return sweeten.all(arguments)((a) => fn.apply(ctx, a));\n        }\n        ;\n}\n\nfunction nWait(timeout) {\n    var stop;\n    const waiter = new nativePromise((resolve, reject) => {\n        let id = setTimeout(resolve, timeout);\n        stop = (execute) => {\n            if(id) {\n                clearTimeout(id);\n                execute ? resolve(id) : reject(id);\n                id = undefined;\n            }\n            return waiter;\n        }\n    });\n    waiter.stop = stop;\n    return waiter;\n}\n\nfunction wait(timeout) {\n    let waiter = nWait(timeout);\n    const { stop } = waiter;\n    waiter = sweeten(waiter);\n    waiter.stop = stop;\n    return waiter;\n}\n\nfunction isThenable(p) {\n    return p && typeof p.then === 'function';\n}\n\nfunction _constant(val) {\n    return () => val;\n}\n"],"names":["VERSION","nativePromise","Promise","globalThis","window","global","self","isArray","Array","val","sweeten","p","isThenable","resolve","then","PromisePrototype","prototype","constructor","_catch","_finally","timeout","_timeout","progress","onResolve","onReject","onNotify","arguments","_constant","apply","undefined","callback","value","resolver","reason","expires","throws","promise","waiter","nWait","stop","error","Error","race","_defer","result","reject","notify","all","any","prom","errors","count","push","AggregateError","name","from","forEach","allSettled","map","status","allValues","keys","Object","len","length","values","isIndexed","i","k","ret","when","defer","deferred","call","wait","fn","usePromise","PromiseConstructor","ctx","a","id","setTimeout","execute","clearTimeout"],"mappings":"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"}